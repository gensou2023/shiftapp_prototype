# シフト最適化デモ — プロジェクトガイド

## プロジェクト概要

倉庫業務のアルバイトシフトを AI で自動最適化するデモアプリ。
営業ツールとして「これくらいならできる」を見せ、松竹梅プランを提示するためのもの。

- **クライアント:** 大阪・倉庫業務
- **営業担当:** 営業チーム
- **デプロイ:** Cloudflare Pages（静的HTML）
- **リポジトリ:** `gensou2023/shiftapp_prototype`

## 技術スタック

| レイヤー | 技術 |
|---------|------|
| 構成 | 静的 HTML + CSS + Vanilla JS（3ファイル分離） |
| スタイル | CSS Variables（Material Design + Primer + shadcn/ui トークン統合） |
| インタラクション | Vanilla JS |
| デプロイ | Cloudflare Pages |

## ファイル構成

```
shift-management-demo/
├── CLAUDE.md              ← このファイル
├── index.html             ← HTMLマークアップ（~437行）
├── style.css              ← デザイントークン + 全スタイル（~973行）
├── app.js                 ← インタラクションロジック + データ（~1425行）
└── docs/
    ├── agents/            ← エージェントロール定義
    │   ├── pdo.md
    │   ├── designer.md
    │   └── frontend.md
    ├── requirements.md    ← 要件定義書
    ├── plan-tiers.md      ← 松竹梅プラン
    └── session-logs/      ← セッション作業記録
        └── 2026-02-19.md
```

## デモ画面構成

| 画面 | 概要 | 状態 |
|------|------|------|
| ダッシュボード | KPIカード・日次タイムライン・3スロットサマリー | DONE |
| スタッフ一覧 | 名前・スキルレベル・出勤可能日・時間帯・勤続年数・部署フィルタ | DONE |
| シフト自動生成 | 出荷量入力 → 3アルゴリズム比較 → 最適シフト提案 | DONE |
| シフトカレンダー | 月間シフト表示・日付詳細・リアルなステータス分布 | DONE |

## 実装済み機能一覧

### ダッシュボード
- KPIカード（登録スタッフ数・今週のシフト・出荷レベル）
- **日次タイムライン**: 6:00〜翌8:00の時間軸に早番/遅番/夜勤バー表示 + 現在時刻ライン
- **3スロットサマリーカード**: 早番・遅番・夜勤ごとにスタッフチップ + スコアバー + 充足バッジ

### スタッフ一覧
- 85名のスタッフカード（部署別フィルタ・検索）
- スタッフ編集モーダル（名前・部署・スキル・出勤日・時間帯・時給・貢献度）
- **勤続年数バッジ**: 決定論的ハッシュ生成（入社日・勤続・スキル推移・部署異動）
- **CSV取込**: 稼働希望日・時間帯の一括インポート（プレビュー → 適用）

### シフト自動生成
- 3アルゴリズム比較（効率重視・コスト最小・バランス）+ Ganttタイムライン
- **欠勤・代替サジェスト**: スタッフチップクリック → スコア影響 + 代替候補3名
- **シフト確定ボタン**: 確定 → トースト通知 → カレンダー反映
- **連勤・労務チェック警告**: 6連勤以上/夜勤→早番のインターバル不足を自動検知
- **週間シフトビュー**: 月〜土6日分のシフトをグリッド一括生成
- Excel(CSV)出力

### シフトカレンダー
- 月間カレンダー（リアルなステータス分布 — シード付きPRNG）
- 日付クリックで詳細パネル表示

### その他
- **設定モーダル**: 表示設定/通知設定/アカウント（3タブ）
- トースト通知システム
- レスポンシブ対応（モバイルファースト）

## デザインシステム（3システム統合）

### カラートークン（Material Design ベース）

| トークン | 用途 |
|---------|------|
| `--color-primary` (#1a73e8) | メインアクション・早番バー |
| `--color-surface` | 背景 |
| `--color-on-surface` | テキスト |
| `--color-success` | シフト充足・確定 |
| `--color-warning` | 人員不足・労務警告 |
| `--color-danger` | シフト衝突・エラー・現在時刻ライン |

### 追加カラー

| カラー | 用途 |
|--------|------|
| `#7c3aed` | 遅番スロット（パープル） |
| `#1e3a5f` | 夜勤スロット（ダークネイビー） |

### UIパターン（shadcn/ui 参考）

| パターン | 適用箇所 |
|---------|---------|
| Card | スタッフカード・シフトサマリー・KPI |
| Badge | ステータス表示（充足・人員不足・勤続年数） |
| Form | 出荷量入力・スタッフ登録 |
| Calendar Grid | シフトカレンダー |
| Modal | スタッフ編集・設定・CSV取込 |
| Timeline | 日次シフトタイムライン・Ganttチャート |
| Toast | 操作完了通知 |

### フォント

- 見出し: `Inter` or `Noto Sans JP`（ウェイト: 600-700）
- 本文: `Noto Sans JP`（ウェイト: 400-500）

## 個人情報の扱い

- **実名は使用禁止** — すべてサンプル名（佐藤浩司、大野貴之 等）に置換
- 受領済みシフト表のデータ構造のみ参照し、実データはコミットしない

## コーディング規約

- セマンティック HTML（`<section>`, `<form>`, `<nav>` 等を適切に使用）
- CSS 変数でデザイントークン管理（ハードコード色は禁止）
- モバイルファースト（倉庫現場 = スマホ閲覧メイン）
- 日本語 UI テキスト
- アクセシビリティ: コントラスト比 4.5:1 以上
- **ファイル分離**: HTML / CSS / JS を別ファイルに管理

## 開発ルール

MenuCraft AI / Cursor道場の開発経験から得たベストプラクティス。**必ず守ること。**

### 1. セッション開始時の確認

実装に入る前に、以下を確認する:

```
- [ ] CLAUDE.md の内容が最新か
- [ ] 前回セッションの残タスクを確認
- [ ] git ブランチと未コミット変更の確認
- [ ] シフト表の実名データがコミット対象に含まれていないか
```

### 2. 計画駆動の開発

- 3つ以上の画面・機能を実装する場合は、**依存関係を明示した計画を先に書く**
- 依存関係のない部分は並列エージェントで一括作成してよい
- Phase 分けで1セッションでの完成を目指す

### 3. 実装後の確認チェックリスト

```
- [ ] index.html をブラウザで開いて表示確認
- [ ] モバイル表示（DevTools レスポンシブモード）確認
- [ ] サンプルデータで全画面の操作確認
- [ ] 実名データが一切含まれていないことの確認
- [ ] Cloudflare Pages へのデプロイテスト
```

### 4. CLAUDE.md とセッションログの更新タイミング

- **機能実装が一段落したら即座に更新する**（セッション終盤まで待たない）
- 長時間セッションではコンテキスト圧縮が起きるため、早めにドキュメント化
- セッションログは `docs/session-logs/YYYY-MM-DD.md`

### 5. デモデータの管理

- スタッフデータは `app.js` 内にコンパクトフォーマットで定義（85名）
- 実際のシフト表データの構造のみ参考にし、値はすべてダミー
- 決定論的データ生成: `staffHash()` による入社日・スキル推移・部署異動の自動生成

## 実装 Phase 履歴

| Phase | 内容 | 状態 |
|-------|------|------|
| 0 | 要件定義・データモデル設計 | DONE |
| 1 | デザイントークン（style.css）+ HTML骨格 | DONE |
| 2 | スタッフ一覧画面 | DONE |
| 3 | シフト自動生成画面（3アルゴリズム比較） | DONE |
| 4 | シフトカレンダー画面 | DONE |
| 5 | 85名スケールアップ + 部署システム | DONE |
| 6 | Ganttタイムライン + ラベル最適化 | DONE |
| 7 | 欠勤代替・確定・労務警告・週間ビュー | DONE |
| 8 | 設定・カレンダー改善・CSV取込・勤続履歴 | DONE |
| 9 | 日次タイムライン + 3スロットサマリー | DONE |
| 10 | コード分離（HTML/CSS/JS）+ ドキュメント整備 | DONE |

## エージェント構成

チーム開発では以下のロール MD を参照:

| ロール | ファイル | 責務 |
|--------|---------|------|
| PdO | `docs/agents/pdo.md` | 要件定義・優先度・松竹梅プラン設計 |
| デザイナー | `docs/agents/designer.md` | デザインシステム統合・UIパターン |
| フロントエンド | `docs/agents/frontend.md` | HTML/CSS/JS 実装 |

## モバイルCSS安全規約

今回のiOS Safari対応（2026-02-19 第3セッション）で得た教訓。

### CSS Grid

- `grid-template-columns` で `1fr` を使う場合、子要素に固定幅コンテンツ（`min-width`, テーブル, タイムライン等）がある場合は **必ず `minmax(0, 1fr)`** を使用する
- `1fr` は暗黙的に `min-width: auto`（子の最小コンテンツ幅）を持つため、固定幅の子がグリッド列を拡張する

### iOS Safari 既知の挙動

- `overflow-y: auto` と `overflow-x: hidden` の組み合わせで**水平クリッピングが効かない** → `html` 要素に `overflow: hidden` が必要
- `<input type="date">` はネイティブ装飾で `width: 100%` を超える → `-webkit-appearance: none` でカスタムスタイル化
- `100vh` がアドレスバーを含む → `100dvh` を使用（`100vh` をフォールバックとして残す）

### モバイルデバッグ手順

CSS修正に着手する前に、必ず以下の切り分けを行う:

1. **スクリーンショット収集** — 操作前 / 操作後 / 複数画面
2. **状態の特定** — 初期表示で崩れるのか？特定操作の後か？
3. **要素の特定** — どの要素が親を押し広げているかを特定してから修正
4. **推測でパッチを重ねない** — 根本原因を特定するまでコードを変更しない

## 参考プロジェクト

| プロジェクト | リポジトリ | 参考ポイント |
|-------------|-----------|-------------|
| MenuCraft AI | `gensou2023/sharemenu_webapp` | CLAUDE.md構造・エージェントMD・デザインシステム |
| Cursor道場 | `gensou2023/any-toolstudy-app` | 開発ルール・Phase分け実装・セッションログ |
