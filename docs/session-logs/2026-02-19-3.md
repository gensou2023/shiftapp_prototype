# セッションログ — 2026-02-19（第3セッション）

## セッション概要

| 項目 | 内容 |
|------|------|
| 日付 | 2026/02/19（夜） |
| 目的 | iPhoneモバイル表示の修正 + モバイルコーディングガイドライン策定 |
| 成果 | iOS Safari横はみ出し根本修正 + ガイドラインMD新規作成 + エージェントMD連携 |
| 最終コミット | セッションログコミット |

---

## 修正した問題

### iPhone モバイル表示の横はみ出し

#### 症状
- シフト生成ページでレベルボタン（通常・超繁忙）が右に見切れる
- 「AIでシフト生成」ボタン押下後、結果カード全体が右にはみ出す
- タイムライン、スタッフチップ、確定ボタンが画面右に見切れる
- 日付入力（input[type="date"]）がカードからはみ出す

#### 根本原因（特定に約1時間）

| # | 原因 | 影響 |
|---|------|------|
| 1 | CSS Grid `1fr` の暗黙的 `min-width: auto` | タイムライン(`min-width:500px`)がグリッド列全体を500pxに拡張 |
| 2 | iOS Safari: `overflow-y:auto` + `overflow-x:hidden` の組み合わせ | 水平クリッピングが効かず、子要素のはみ出しがviewportを拡張 |
| 3 | iOS Safari: `input[type="date"]` のネイティブ装飾 | `width:100%` を超える幅でレンダリング |

#### 修正内容

| 修正 | 内容 | コミット |
|------|------|---------|
| **根本修正** | `@media (max-width:1024px)` の `grid-template-columns: 1fr` → `minmax(0, 1fr)` | `d5c7394` |
| viewport固定 | `html { overflow: hidden; width: 100%; }` 追加 | `3390ed2` |
| date input | `-webkit-appearance: none` でカスタムスタイル化 | `4ea9c6d` |
| Android対応 | 360px以下のブレイクポイント追加 | `f31ec27` |

---

## 不採用だったアプローチ（学び）

根本原因を特定するまでに試した「パッチ」アプローチ:

| パッチ | なぜ効かなかったか |
|--------|-----------------|
| `overflow: hidden` を各子要素に追加 | 親のグリッド列自体が拡張されているため、子要素でクリップしても意味がない |
| `max-width: 100%` を各要素に追加 | `100%` の基準となる親が既に拡張されているため効果なし |
| `min-width: 0` を子要素に追加 | ブロック要素には効果なし（flex/grid itemにのみ有効） |
| レベルボタンを1列に変更 | 根本原因を解決せず、他の要素（タイムライン等）は依然はみ出す |

**教訓:** 推測でパッチを重ねず、まずスクリーンショットで状態を切り分け、根本原因を特定してから修正する。

---

## ドキュメント作成

### 新規作成

| ファイル | 内容 |
|---------|------|
| `docs/agents/mobile-guidelines.md` | モバイルコーディングガイドライン（196行） |

事後対応のデバッグ手順ではなく、**最初から守れば問題が起きない**ルール集:
- CSS Grid: `minmax(0, 1fr)` ルール
- Viewport/Overflow: `html { overflow: hidden }`
- フォーム要素: `-webkit-appearance: none`
- iOS Safari / Android Chrome 固有の注意事項
- 実装時チェックリスト

### 更新

| ファイル | 更新内容 |
|---------|---------|
| `CLAUDE.md` | モバイルCSS安全規約セクション追加 + エージェント構成にQA/AI/ドメイン/モバイルガイドライン追加 |
| `docs/agents/frontend.md` | モバイル対応の注意事項 + ガイドラインへの参照リンク |
| `docs/agents/qa.md` | iOS/Android既知問題チェックリスト + ガイドラインへの参照リンク |

---

## KPT振り返り

### Keep
- 最終的にスクリーンショット4枚で根本原因を特定できた
- `minmax(0, 1fr)` という1行の修正で根本解決
- 振り返りからガイドライン策定につなげた

### Problem
- **同じ問題に約1時間かかった** — パッチを8回重ねてから根本原因に到達
- スクリーンショットの「生成前は正常 / 生成後に崩れる」という切り分けに気づくのが遅かった
- CSS Gridの `1fr` = `minmax(auto, 1fr)` という仕様知識を最初に適用できなかった

### Try
- モバイルCSS問題の報告時は**必ず操作前/操作後のスクリーンショット**を収集してから修正に着手
- 新規CSS Grid実装時は `mobile-guidelines.md` のチェックリストを確認
- 推測パッチは最大2回まで — 2回で解決しなければ手を止めて分析

---

## ファイル変更サマリー

| ファイル | 変更内容 |
|---------|---------|
| `style.css` | html overflow:hidden, minmax(0,1fr), date input カスタムスタイル, 480px/360pxブレイクポイント最適化 |
| `app.js` | アラートフィード内の募集ボタンをブロック配置に変更 |
| `CLAUDE.md` | モバイルCSS安全規約 + エージェント構成更新 |
| `docs/agents/mobile-guidelines.md` | 新規作成（196行） |
| `docs/agents/frontend.md` | モバイル対応の注意事項 + ガイドライン参照 |
| `docs/agents/qa.md` | iOS/Android既知問題 + ガイドライン参照 |
| `docs/session-logs/2026-02-19-3.md` | 本ファイル |

## コミット履歴

```
45339fd docs: モバイルコーディングガイドライン新規作成
a7ae6d4 docs: モバイルCSS安全規約・iOS/Android既知問題をドキュメント追加
4ea9c6d fix: 日付入力を必要スコア欄と同じスタイルに統一
76fd45e fix: card-bodyにoverflow:hidden復元（iOS date input はみ出し対応）
d5c7394 fix: 1024px breakpointのgrid列をminmax(0,1fr)に変更 ← 根本修正
f31ec27 fix: Android小画面端末(320-360px)対応 + 480pxグリッド補強
3390ed2 fix: iOS Safari横はみ出しの根本修正 + パッチ整理
7ecc306 fix: レベルボタンをスマホで1列に変更（480px以下）
d80c0b6 fix: レベルボタン右列の見切れを修正（iPhone対応強化）
bb87525 fix: タイムライン(min-width:500px)によるモバイル横はみ出しを修正
eea9203 fix: モバイルレイアウト改善（レベルボタン切れ・ダッシュボード整形）
```
