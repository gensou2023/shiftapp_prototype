# シフト最適化デモ — 要件定義書

## 1. 背景・目的

### 背景
- クライアント（クライアント）は大阪で倉庫業務（倉庫業務会社）を運営
- アルバイトメンバーのシフトを手動で管理している（3ヶ月分のシフト表あり）
- AI を活用してシフト自動生成を実現したい

### 目的
- **デモ**: 「これくらいならできる」を営業担当（営業担当）経由で見せる
- **プラン提示**: 松竹梅の3段階で実現方法を提案する
- **粒度**: メニュー画像生成アプリ（MenuCraft AI）のシンプル版程度

---

## 2. ユーザー

| ユーザー | 役割 | 主な操作 |
|---------|------|---------|
| 倉庫管理者 | シフト作成・管理 | 出荷量入力、シフト生成、確認・調整、スタッフ管理 |
| 倉庫リーダー | シフト確認 | 当日シフトの閲覧 |
| アルバイトスタッフ | 自分のシフト確認 | 自分の出勤日・時間の確認 |

※デモ版では**倉庫管理者**の操作に集中する。

---

## 3. データモデル

### スタッフ（Staff）

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | string | 一意のID |
| name | string | スタッフ名（**サンプル名**） |
| dept | string | 部署（出荷・検品 / 入荷・仕分け / 物流・加工 / 夜間作業） |
| skillLevel | number (1-5) | 業務レベル（1:新人 〜 5:ベテラン） |
| availableDays | string[] | 出勤可能曜日 ["月","火","水"...] |
| availableSlots | string[] | 出勤可能時間帯 ["早番","遅番","夜勤","通し"] |
| hourlyRate | number | 時給（コスト計算用） |
| weight | number (0.5-2.0) | 重み付け（総合スコアへの貢献度） |
| note | string | 備考 |
| hireDate | Date | 入社日（自動生成） |
| tenure | string | 勤続年数表示（自動生成） |
| skillHistory | object[] | スキルレベル変遷（自動生成） |
| deptHistory | object[] | 部署異動履歴（自動生成） |

### 出荷量スコア定義（ShipmentScore）

| フィールド | 型 | 説明 |
|-----------|-----|------|
| level | string | "軽量" / "通常" / "繁忙" / "超繁忙" |
| minScore | number | そのレベルに必要な最低スタッフスコア合計 |
| description | string | 説明 |

### シフト（Shift）

| フィールド | 型 | 説明 |
|-----------|-----|------|
| date | string | 日付 (YYYY-MM-DD) |
| timeSlot | string | "早番" / "遅番" / "夜勤" / "通し" |
| staffIds | string[] | 配置スタッフのID一覧 |
| totalScore | number | 配置スタッフのスキルスコア合計 |
| shipmentLevel | string | その日の出荷量レベル |
| status | string | "確定" / "仮" / "人員不足" |

---

## 4. 機能要件（デモ版）

### 4.1 ダッシュボード画面

- [x] KPIカード（登録スタッフ数・今週のシフト数・出荷レベル）
- [x] 日次タイムライン（6:00〜翌8:00、早番/遅番/夜勤バー + 現在時刻ライン）
- [x] 3スロットサマリーカード（早番・遅番・夜勤ごとにスタッフ配置 + スコア）

### 4.2 スタッフ一覧画面

- [x] スタッフ一覧をカード形式で表示（85名）
- [x] スキルレベルをビジュアル表示（星）
- [x] 出勤可能曜日・時間帯をバッジ表示
- [x] 部署別フィルタ（出荷・検品 / 入荷・仕分け / 物流・加工 / 夜間作業）
- [x] スタッフの追加・編集モーダル
- [x] 勤続年数バッジ + 詳細パネル（入社日・スキル推移・部署異動）
- [x] CSV取込（稼働希望日・時間帯の一括インポート）

### 4.3 シフト自動生成画面

- [x] 日付選択
- [x] 出荷量レベル選択（軽量/通常/繁忙/超繁忙）
- [x] 「シフト生成」ボタンで最適なスタッフ組み合わせを算出
- [x] 結果表示: 配置スタッフ、スコア合計、過不足の表示
- [x] 3アルゴリズム比較表示（効率重視・コスト最小・バランス）
- [x] Ganttタイムライン表示（各スタッフの勤務時間帯）
- [x] 欠勤シミュレーション（スタッフクリック → 代替候補3名提案）
- [x] シフト確定ボタン → カレンダー反映 + トースト通知
- [x] 連勤・労務チェック警告（6連勤以上/夜勤→早番インターバル不足）
- [x] 週間シフトビュー（月〜土6日分グリッド一括生成）
- [x] Excel(CSV)出力

### 4.4 シフトカレンダー画面

- [x] 月間カレンダー表示（リアルなステータス分布）
- [x] 各日にシフト状況サマリー（人数・ステータスバッジ）
- [x] 日付クリックでその日のシフト詳細表示

### 4.5 設定

- [x] 表示設定（ダークヘッダー・コンパクトモード・デフォルトページ）
- [x] 通知設定（シフト変更・労務警告・欠勤通知のトグル）
- [x] アカウント情報表示

---

## 5. 非機能要件

| 項目 | 要件 | 状態 |
|------|------|------|
| レスポンシブ | スマホ（375px〜）で閲覧可能 | DONE |
| パフォーマンス | 初回表示 1秒以内（静的HTMLのため） | DONE |
| ブラウザ対応 | Chrome, Safari, Edge（最新版） | DONE |
| アクセシビリティ | コントラスト比 4.5:1、キーボード操作可能 | DONE |
| 個人情報 | 実名データは一切含まない | DONE |
| コード分離 | HTML / CSS / JS を別ファイル管理 | DONE |

---

## 6. シフト生成アルゴリズム（3種）

### A. 効率重視（algoEfficiency）
```
1. フィルタされたスタッフを skillLevel * weight の降順でソート
2. 上位から順に追加し、合計スコア >= minScore になるまで繰り返す
→ 最少人数で目標スコアを達成
```

### B. コスト最小（algoCostMin）
```
1. フィルタされたスタッフを hourlyRate の昇順でソート
2. 低コスト順に追加し、合計スコア >= minScore になるまで繰り返す
→ 人件費を最小化
```

### C. バランス型（algoBalanced）
```
1. スキル3以上（高）と2以下（低）に分割
2. 高・低を交互に配置し、スコアが目標に達するまで繰り返す
→ ベテランと新人のバランス配置
```

※松プランでは、ここを機械学習ベースの最適化に置き換える。

---

## 7. 解決済み事項

- [x] 時間帯の区分 → 早番/遅番/夜勤/通し の4スロット
- [x] スキルレベルの定義 → 1（新人）〜5（ベテラン）、star表示
- [x] 出荷量スコアの閾値 → 軽量:20, 通常:40, 繁忙:60, 超繁忙:80
- [x] シフト粒度 → 日次生成（週間ビューも対応）
